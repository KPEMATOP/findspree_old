<?php
/**
 * Created by PhpStorm.
 * User: Andrey
 * Date: 28.03.2015
 * Time: 19:07
 */

namespace common\helpers;


use common\models\User;

class Html extends \yii\helpers\Html
{
    public static $colorsAvatar = [
        ['FF9696','FFF'],
        ['FFBE96','FFF'],
        ['FF96CE','FFF'],
        ['96AFFF','FFF'],
        ['FF96CE','FFF'],
        ['F096FF','FFF'],
        ['96DAEA','FFF'],
        ['9FE8BF','FFF'],
    ];

    public static function avatar(User $user, $size = 60, $options = [])
    {
        $size = (int)$size;
        unset($options['height'],$options['width']);
        static::addCssStyle($options,"width:{$size}px;height:{$size}px;");
        static::addCssClass($options,'ava');
        if ($src = $user->getAvatar($size)) {
            return static::img($src, $options);
        } else {
            $size = (int)$size;
            $c  = $size/2;
            $char1 = substr($user->username, 0, 1);
            $char2 = substr($user->username, 1, 1);
            $posCount = count(String::$chars);
            $pos = array_search($char1,String::$chars)?:1;
            $count = count(static::$colorsAvatar);
            $colorKey = (int)floor($pos/$posCount*$count)-1;
            list($backgroundCol,$textCol) = isset(static::$colorsAvatar[$colorKey])? static::$colorsAvatar[$colorKey] : current(self::$colorsAvatar);
            static::addCssClass($options,'fake-avatar');
            static::addCssStyle($options,"line-height:{$size}px;font-size:{$c}px;color:#{$textCol};background:#{$backgroundCol}");
            return static::tag('div',$char1.$char2, $options);
        }
    }
}