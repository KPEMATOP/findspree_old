<?php
/**
 * Created by PhpStorm.
 * User: albert
 * Date: 09.03.15
 * Time: 16:43
 * @var $event \common\models\Event
 * @var $this  \yii\web\View
 */
use common\helpers\String;

$subscribeCount = $event->getSubscribers()->count();
?>
<div class="panel panel-default">
	<div class="panel-body">
		<h3 class="event-title"><?= $event->name; ?> <?= !Yii::$app->user->isGuest && $event->user_id == Yii::$app->user->identity->id ? '<i class="md-border-color pull-right event-descr-edit" id="event-descr-edit-icon" data-href="' . \yii\helpers\Url::to([
					'event/save',
					'event_id' => $event->id,
					'user_id'  => \Yii::$app->user->identity->id,
					'type'     => 'edit-description'
				]) . '"></i>' : ''; ?></h3>
		<hr>
		<p class="text-muted" id="event-description">
			<?= html_entity_decode($event->description); ?>
		</p>
		<hr/>
		<p>
			<span title="Категория"><i class="md  md-chevron-right"></i> <?= $event->type->name; ?></span><br/>
			<span title="Адрес"><i class="md  md-place"></i> <?= $event->geo_description; ?></span><br/>
			<?php if ($event->site): ?>
				<span title="Сайт"> <i class="md-assignment"></i> <a href="<?= $event->site?>" target="_blank"><?=$event->site ?></a>
					</span><br/>
			<?php endif ?>
			<?php if ($event->price): ?>
				<span title="Стоимость"> <i class="md-account-balance-wallet"></i> <?= String::price($event->price); ?>
					руб.</span><br/>
			<?php endif ?>

			<span title="Дата начала"><i
					class="md md-alarm-on"></i>  <?= \common\helpers\Time::dateNormalize($event->begin); ?>
				<?php if ($com1 = \common\helpers\Time::period($event->begin)): ?>
					<small class="text-muted">( Осталось <?= $com1; ?>)</small>
				<?php endif; ?></span>
			<br/>
			<?php if($event->end): ?>
			<span title="Продолжительность">
				<i class="md md-alarm"></i>  <?= \common\helpers\Time::period([
					$event->begin,
					$event->end
				], \common\helpers\Time::PERIOD_TIME_PASSED) ?>
			</span>
			<br/>
			<span title="Дата окончания"><i
					class="md md-alarm-off"></i>  <?= \common\helpers\Time::dateNormalize($event->end); ?>
				<?php if (!$com1 && $com2 = \common\helpers\Time::period($event->begin)): ?>
					<small class="text-muted">( Осталось <?= $com2; ?>)</small>
				<?php endif; ?>
			</span>
			<br/>
			<?php endif ?>
			<span title="Количество просмотров события"><i
					class="md md-remove-red-eye"></i>  <?= String::declension($event->getShows()->count(), [
					'просмотр',
					'просмотра',
					'просмотров'
				]); ?></span>
			<br/>
			<?php if ($subscribeCount): ?>
				<i class="md md-people"></i>  <?= String::declension($subscribeCount, [
					'человек пойдет',
					'человека пойдут',
					'человек пойдут'
				]); ?>.
			<?php endif ?>
		</p>
		<hr/>

		<?php if (!empty($event->tags)): ?>
			<?php foreach ($event->tags as $tag): ?>
				<span class="label label-primary tag-link"><?= $tag->name; ?></span>
			<?php endforeach; ?>
		<?php endif ?>
		<span class="pull-right">
			<?= \common\widgets\Share::widget([
				'title'       => $event->name,
				'description' => $event->description,
				'viewName'    => '@app/views/tpl/sharelink.php',   //custom view file for you links appearance
				'url'         => \yii\helpers\Url::to(['event/view', 'id' => $event->id], true),
				'image'       => $event->getImage(\common\models\Event::IMAGE_MAIN, [
					'onlyLink'    => true,
					'absoluteUrl' => true
				])
			]);; ?>
		</span>
	</div>
</div>