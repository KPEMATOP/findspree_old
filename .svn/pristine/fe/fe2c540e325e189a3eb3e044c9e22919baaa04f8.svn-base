<?php
/**
 * Created by PhpStorm.
 * User: Andrey
 * Date: 28.03.2015
 * Time: 19:07
 */

namespace common\helpers;


use common\models\User;

class Html extends \yii\helpers\Html
{
    public static $colorsAvatar = [
        ['FF96CE','FFF'],
		['FF9696','FFF'],
        ['75BDA4','FFF'],
        ['DD90F2','FFF'],
        ['89E6EA','FFF'],
		['F096FF','FFF'],
		['96AFFF','FFF'],
		['9FE8BF','FFF'],
		['FFBE96','FFF'],
		['96DAEA','FFF'],
		['A5FF96','FFF'],
	];

    public static function avatar(User $user, $size = 60, $options = [])
    {
        $size = (int)$size;
        unset($options['height'],$options['width']);
        static::addCssStyle($options,"max-width:{$size}px;max-height:{$size}px;");
        static::addCssClass($options,'ava');
        if ($src = $user->getAvatar($size)) {
            return static::img($src, $options);
        } else {
            $size = (int)$size;
            $c  = $size/2;
            $char1 = substr($user->username, 0, 1);
            $char2 = substr($user->username, 1, 1);
            $posCount = count(String::$chars);
            $pos = array_search(mb_strtolower($char1),String::$chars)?:0;
            $pos2 = array_search(mb_strtolower($char2),String::$chars)?:0;
            $count = count(static::$colorsAvatar);
            $colorKey = (int)floor(($pos+$pos2)/($posCount*2)*$count);
            list($backgroundCol,$textCol) = isset(static::$colorsAvatar[$colorKey])? static::$colorsAvatar[$colorKey] : current(self::$colorsAvatar);
            static::addCssClass($options,'fake-avatar');
            static::addCssStyle($options,"line-height:{$size}px;font-size:{$c}px;color:#{$textCol};background:#{$backgroundCol}");
            return static::tag('span',$char1.$char2, $options);
        }
    }
}