<?php

namespace common\models;

use common\models\Wall\DataContainer;
use Yii;
use yii\behaviors\TimestampBehavior;

/**
 * This is the model class for table "user_wall".
 * @property string  $id
 * @property string  $created
 * @property string  $mem
 * @property string  $type
 */
class Wall extends \yii\db\ActiveRecord
{
	private $_data;
    public function behaviors()
    {
        return [
            [
                'class' => TimestampBehavior::className(),
                'createdAtAttribute' => 'created',
                'updatedAtAttribute' => false,
            ],
        ];
    }
    /**
     * @inheritdoc
     */
    public static function tableName()
    {
        return 'wall';
    }

    /**
     * @inheritdoc
     */
    public function rules()
    {
        return [
            [['data','type'], 'required'],
        ];
    }

    public function setData(DataContainer $WPost)
    {
        $this->_data = $WPost;
		$this->type = $WPost->getType();
    }

    /**
     * @return DataContainer|null
     * @throws \ErrorException
     */
    public function getData()
    {
		if($this->_data)
			return $this->_data;
		if(!$this->mem)
			return null;
        return $this->_data = DataContainer::convert($this->type,$this->mem);
    }

    public function beforeSave($insert)
    {
        if(!$this->getData() || !$this->getData()->validate()){
            $this->addError('mem','Неверно заполнены данные');
            return false;
        }
        $this->mem = (string)$this->getData();
        return parent::beforeSave($insert);
    }
    /**
     * @inheritdoc
     */
    public function attributeLabels()
    {
        return [
            'id'      => 'ID',
            'title'   => 'Title',
            'created' => 'Created',
            'data'    => 'Data',
            'type'    => 'Type',
        ];
    }
}
